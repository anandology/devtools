{"id":"dev-0ys","title":"VM build fails on Ubuntu 22.04 when targeting Ubuntu 24.04 (noble)","description":"When running `./vm.sh build` on Ubuntu 22.04 host to build a VM with Ubuntu 24.04 (noble), debootstrap fails because the host's debootstrap package doesn't include scripts for noble.\n\n**Error Context:**\n- Host OS: Ubuntu 22.04\n- Target VM OS: Ubuntu 24.04 (noble) - the default in config.sh\n- Tool: debootstrap\n\n**Root Cause:**\nThe debootstrap package on Ubuntu 22.04 doesn't include scripts for Ubuntu 24.04 (noble) since noble was released after 22.04.\n\n**Scope:**\nUpdate vm-init.sh to default to Ubuntu 22.04 (jammy) when the host is running Ubuntu 22.04, or add validation to warn users about this limitation.\n\n**Acceptance Criteria:**\n- VM builds successfully on Ubuntu 22.04 hosts\n- Either: auto-detect host version and use compatible default, OR provide clear error message with instructions","notes":"## Proposed Solution: Use Docker for debootstrap\n\nInstead of modifying system files or downgrading defaults, we can use Docker to build the rootfs with any target Ubuntu version, regardless of the host OS.\n\n**Approach:**\nRun debootstrap inside a Docker container with the target Ubuntu version:\n\n```bash\ndocker run --rm --privileged \\\n  -v /path/to/rootfs:/rootfs \\\n  ubuntu:24.04 \\\n  bash -c 'apt-get update \u0026\u0026 apt-get install -y debootstrap \u0026\u0026 \\\n           debootstrap noble /rootfs http://archive.ubuntu.com/ubuntu/'\n```\n\n**Benefits:**\n- Build any Ubuntu version VM from any host\n- No system file modifications needed\n- Keep the default as 24.04 (latest LTS)\n- Just requires Docker (commonly available)\n- Isolated and reproducible builds\n\n**Implementation:**\nModify `vm-build.sh` to:\n1. Check if Docker is available\n2. Detect if host's debootstrap supports target Ubuntu version\n3. Use Docker for debootstrap if needed\n4. Fall back to direct debootstrap if the host version is compatible\n\nThis is cleaner and safer than modifying system files or requiring users to upgrade their host OS.\n## Implementation Complete\n\nThe Docker-based solution has been implemented and tested successfully.\n\n**Changes made:**\n- Added `check_docker()` function to detect Docker availability\n- Added `check_debootstrap_support()` to check if host debootstrap supports target Ubuntu version\n- Added `run_debootstrap_docker()` to run debootstrap inside Docker container\n- Modified build logic to automatically use Docker when host debootstrap doesn't support the target version\n- Falls back to host debootstrap when available and compatible\n\n**Testing:**\n- Tested building Ubuntu 24.04 (noble) VM on Ubuntu 22.04 host\n- Docker automatically used since host debootstrap doesn't support noble\n- Build completed successfully\n\nThe fix allows building any Ubuntu version VM from any host OS, without requiring system modifications or version downgrades.","status":"closed","priority":1,"issue_type":"bug","owner":"anandology@gmail.com","created_at":"2026-02-05T21:57:57.707086968+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T22:24:50.131377298+05:30","closed_at":"2026-02-05T22:24:50.131377298+05:30","close_reason":"Closed","labels":["compatibility","firecracker-sandbox"]}
{"id":"dev-5w0","title":"setup.sh fails when systemd service already exists","description":"When running setup.sh after the firecracker-bridge.service already exists (e.g., re-running setup after a previous installation), the script regenerates the service file but doesn't properly reload the running service.\n\n**Problem:**\n- setup.sh regenerates /etc/systemd/system/firecracker-bridge.service\n- It runs systemctl daemon-reload and systemctl start\n- But if the service is already running, systemctl start does nothing\n- The bridge creation fails because the old service definition is still active\n\n**Root Cause:**\nPreviously the service used inline bash commands. We refactored to use bridge-up.sh and bridge-down.sh scripts. When re-running setup.sh, the service file gets updated but the running service continues using the old configuration.\n\n**Solution:**\nUsers must manually restart the service:\n  sudo systemctl stop firecracker-bridge.service\n  sudo systemctl daemon-reload  \n  sudo systemctl start firecracker-bridge.service\n\n**Better Fix:**\nsetup.sh should do: systemctl restart instead of systemctl start\nOr: systemctl stop before the daemon-reload, then start","status":"closed","priority":1,"issue_type":"bug","owner":"anandology@gmail.com","created_at":"2026-02-05T21:35:24.433693383+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T21:35:39.003837842+05:30","closed_at":"2026-02-05T21:35:39.003837842+05:30","close_reason":"Closed"}
{"id":"dev-a9j","title":"packages.nix should use actual Nix expression format","description":"The current packages.nix file uses a misleading format - it's just space-separated package names, not actual Nix code.\n\n**Current Implementation:**\n- File is named packages.nix but contains plain text: `go_1_24 nodejs`\n- Script parses it and runs: `nix-env -iA nixpkgs.\u003cpackage\u003e` for each\n- Package names may be incorrect (e.g., go_1_24 might not be a valid nixpkgs attribute)\n\n**Problems:**\n1. Misleading filename - .nix extension suggests Nix expression\n2. Package names are hard to verify (need to manually check nixpkgs)\n3. No validation - users don't know if names are correct until first boot fails\n4. Can't use Nix expressions or compose packages\n\n**Proposed Solution:**\nUse proper Nix expression format:\n\n```nix\n# packages.nix\n{ pkgs ? import \u003cnixpkgs\u003e {} }:\n\nwith pkgs; [\n  go\n  nodejs\n  python3\n  postgresql\n  tmux\n  vim\n]\n```\n\nThen install with: `nix-env -iA -f packages.nix`\n\n**Benefits:**\n1. Proper Nix syntax - users can validate with `nix-instantiate --eval packages.nix`\n2. Correct package names from nixpkgs\n3. Can use Nix expressions, overrides, and composition\n4. IDE support and syntax highlighting\n5. Consistent with Nix ecosystem conventions\n\n**Alternative:**\nIf simplicity is preferred, rename to `nix-packages.txt` and document it's plain text, not Nix code.\n\n**Files to Change:**\n- bin/vm-init.sh (generate proper Nix expression)\n- bin/first-boot.sh (use `nix-env -iA -f packages.nix`)\n- Documentation/examples","status":"closed","priority":2,"issue_type":"bug","owner":"anandology@gmail.com","created_at":"2026-02-05T21:47:27.981964004+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T21:49:36.836933814+05:30","closed_at":"2026-02-05T21:49:36.836933814+05:30","close_reason":"Closed"}
{"id":"dev-aq9","title":"Firecracker VM Management Framework","description":"Create a simple, lightweight framework for managing Firecracker VMs targeted at individual developers. The framework should support:\n- One-time system setup with minimal friction\n- Easy VM creation from templates\n- Sudo-less daily VM operations (start/stop/ssh)\n- Multiple simultaneous VMs with bridge networking\n- Ubuntu 24.04 base images with customizable packages\n- Clean system cleanup to completely remove the framework when no longer needed\n\nKey outcomes:\n- Developers can create isolated VM environments for AI agent testing\n- Fast VM boot times (~1 second)\n- Clean separation between privileged setup and daily operations\n- Persistent user-owned TAP devices enabling sudo-less VM management\n- Easy uninstall path - complete removal of bridge, TAP devices, and VM instances","status":"closed","priority":1,"issue_type":"epic","owner":"anandology@gmail.com","created_at":"2026-02-05T17:41:32.465128883+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:09:02.384845442+05:30","closed_at":"2026-02-05T19:09:02.384848425+05:30"}
{"id":"dev-aq9.1","title":"Global Setup \u0026 Cleanup Scripts","description":"Create global system setup and cleanup infrastructure for the Firecracker VM framework.\n\n**Scope:**\n\n1. **bin/config.sh** - Global configuration file\n   - BRIDGE_NAME=\"br-firecracker\"\n   - BRIDGE_IP=\"172.16.0.1/24\"\n   - FIRECRACKER_VERSION=\"v1.7.0\" (or latest)\n   - HOST_IFACE detection for NAT\n\n2. **bin/setup.sh** - One-time system setup (requires sudo)\n   - Download firecracker binary to bin/firecracker\n   - Verify KVM support and prerequisites\n   - Create systemd service file at /etc/systemd/system/firecracker-bridge.service\n     * Service contains bridge creation logic (ip link add, ip addr add, iptables rules, ip forwarding)\n     * Type=oneshot with RemainAfterExit=yes\n     * ExecStart creates bridge and NAT rules\n     * ExecStop tears down bridge\n   - systemctl daemon-reload\n   - systemctl enable firecracker-bridge (auto-start on boot)\n   - systemctl start firecracker-bridge (create bridge now)\n   - Create state/bridge symlink to /sys/class/net/br-firecracker\n   - Bridge persists across reboots automatically\n\n3. **bin/cleanup.sh** - System-wide cleanup (requires sudo)\n   - Stop all running VMs\n   - Destroy all VM instances (calls vm.sh destroy for each)\n   - systemctl stop firecracker-bridge\n   - systemctl disable firecracker-bridge\n   - Remove /etc/systemd/system/firecracker-bridge.service\n   - systemctl daemon-reload\n   - Remove state directory\n\n**State Management:**\n- state/bridge -\u003e /sys/class/net/br-firecracker (symlink indicates bridge exists)\n- Broken symlink = bridge doesn't exist\n\n**Systemd Service:**\nBridge creation logic lives in the systemd service, not duplicated in setup.sh. This ensures:\n- Single source of truth for bridge management\n- Automatic bridge recreation on reboot\n- Clean service lifecycle management\n\n**Acceptance Criteria:**\n- setup.sh completes successfully on fresh Ubuntu system\n- Bridge is created and accessible at 172.16.0.1\n- Firecracker binary is executable and has correct permissions\n- systemctl status firecracker-bridge shows active\n- Bridge survives system reboot\n- cleanup.sh removes all traces: service, bridge, state\n- Scripts have clear error messages and validation","status":"closed","priority":1,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T17:54:20.465337006+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:08:49.687714431+05:30","closed_at":"2026-02-05T19:08:49.687718329+05:30","dependencies":[{"issue_id":"dev-aq9.1","depends_on_id":"dev-aq9","type":"parent-child","created_at":"2026-02-05T17:54:20.466989655+05:30","created_by":"Anand Chitipothu"}]}
{"id":"dev-aq9.10","title":"VM SSH Command (vm-ssh.sh)","description":"Implement VM ssh command to connect to a running VM.\n\n**Command:** `~/vms/vm.sh ssh \u003cname\u003e [ssh-args]` (no sudo required)\n\n**Scope:**\n\n1. **Validation**\n   - Check VM exists\n   - Check VM is running (validate state/vm.pid)\n   - If not running, error: \"VM 'name' is not running. Start it with: ~/vms/vm.sh up \u003cname\u003e\"\n   - Load config.sh and state files\n\n2. **Read Connection Info**\n   - Get IP from state/ip.txt\n   - Get USERNAME from config.sh\n   - Get SSH key path from config.sh or use default\n\n3. **Execute SSH Connection**\n   - Build SSH command with proper options:\n     ```bash\n     exec ssh -o StrictHostKeyChecking=no \\\n              -o UserKnownHostsFile=/dev/null \\\n              -i \u003cssh_key_path\u003e \\\n              \u003cusername\u003e@\u003cip\u003e \\\n              \"$@\"\n     ```\n   - Use exec to replace current process (clean exit)\n   - Pass through any additional arguments (e.g., commands, -L for port forwarding)\n\n4. **Support Remote Commands**\n   - `vm.sh ssh claude` - Interactive shell\n   - `vm.sh ssh claude \"ls -la\"` - Run command\n   - `vm.sh ssh claude -L 5432:localhost:5432` - Port forwarding\n\n**No Sudo Required:**\n- Pure SSH connection\n- Uses user's SSH key\n\n**Error Handling:**\n- Clear error if VM not running\n- SSH connection errors pass through\n- Helpful message if SSH key not found\n\n**Acceptance Criteria:**\n- Connects to running VM without sudo\n- Opens interactive shell by default\n- Supports passing commands and SSH arguments\n- Clean error if VM not running\n- Works with custom SSH keys from config\n- Port forwarding works","status":"closed","priority":1,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T18:47:52.564689895+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:08:57.56309246+05:30","closed_at":"2026-02-05T19:08:57.563095948+05:30","dependencies":[{"issue_id":"dev-aq9.10","depends_on_id":"dev-aq9","type":"parent-child","created_at":"2026-02-05T18:47:52.566611947+05:30","created_by":"Anand Chitipothu"},{"issue_id":"dev-aq9.10","depends_on_id":"dev-aq9.8","type":"blocks","created_at":"2026-02-05T18:48:40.74558949+05:30","created_by":"Anand Chitipothu"}]}
{"id":"dev-aq9.11","title":"VM Status Command (vm-status.sh)","description":"Implement VM status command to show detailed information about a single VM.\n\n**Command:** `~/vms/vm.sh status \u003cname\u003e` (no sudo required)\n\n**Scope:**\n\n1. **Validation**\n   - Check VM exists\n   - Load config.sh and state files\n   - Handle missing files gracefully\n\n2. **Gather VM Information**\n   - VM name (directory name)\n   - Status: pending/stopped/running/crashed\n   - IP address (from state/ip.txt)\n   - TAP device (from state/tap_name.txt or derive)\n   - Resources: CPUs, Memory (from config.sh)\n   - Disk images: rootfs.ext4 and home.ext4 sizes\n   - Username (from config.sh)\n   \n3. **Running VM Details** (if status = running)\n   - PID (from state/vm.pid)\n   - Uptime (calculate from process start time)\n   - Memory usage (from /proc/\u003cpid\u003e/status)\n   - CPU usage (if easily available)\n   - SSH connectivity: test if SSH port is reachable\n\n4. **Display Format**\n   - Show information in clear, readable format:\n     ```\n     VM: claude\n     Status: running\n     IP: 172.16.0.2\n     Username: anand\n     Uptime: 2h 34m\n     \n     Resources:\n       CPUs: 4\n       Memory: 8192 MB (2.3 GB used)\n       TAP device: tap-claude\n     \n     Disks:\n       Root: 8.0 GB (~/vms/vms/claude/rootfs.ext4)\n       Home: 20.0 GB (~/vms/vms/claude/home.ext4)\n     \n     Process:\n       PID: 12345\n     \n     SSH: ssh anand@172.16.0.2\n     ```\n\n5. **Pending Status Display**\n   - Show limited info if VM not built yet:\n     ```\n     VM: postgres\n     Status: pending (not built)\n     IP: 172.16.0.4 (assigned)\n     \n     Config: ~/vms/vms/postgres/config.sh\n     Next: sudo ~/vms/vm.sh build postgres\n     ```\n\n6. **Error States**\n   - Show helpful messages for crashed/stale state\n   - Suggest recovery commands\n\n**No Sudo Required:**\n- Read-only operations\n- Uses /proc for process info\n\n**Acceptance Criteria:**\n- Shows comprehensive VM information\n- Works for all VM states (pending/stopped/running/crashed)\n- Clean, readable output format\n- Shows resource usage for running VMs\n- Calculates uptime correctly\n- Handles missing/corrupted state gracefully\n- Provides helpful next steps for each state","status":"closed","priority":1,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T18:48:10.135220812+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:08:58.133380933+05:30","closed_at":"2026-02-05T19:08:58.133385516+05:30","dependencies":[{"issue_id":"dev-aq9.11","depends_on_id":"dev-aq9","type":"parent-child","created_at":"2026-02-05T18:48:10.13771271+05:30","created_by":"Anand Chitipothu"}]}
{"id":"dev-aq9.12","title":"Package Distribution Script (package.sh)","description":"Create packaging script to generate vms.zip for distribution.\n\n**Goal:** Package the framework into vms.zip that users can extract to ~/vms/\n\n**Scope:**\n\n1. **Create package.sh Script**\n   - Lives at firecracker-sandbox/package.sh\n   - Creates vms.zip with proper structure\n   - Excludes development files\n\n2. **Package Contents**\n   - Include:\n     * vm.sh (main entry point)\n     * bin/ directory (all scripts)\n     * lib/ directory (helper functions)\n     * README.md (user documentation)\n   - Exclude:\n     * notes.md (internal design doc)\n     * package.sh itself\n     * .git files\n     * state/, kernels/, vms/ (created at runtime)\n     * Editor temp files (*.swp, *~, .DS_Store)\n\n3. **Packaging Script**\n   ```bash\n   #!/bin/bash\n   set -e\n   \n   cd \"$(dirname \"$0\")\"\n   \n   echo \"Creating vms.zip...\"\n   \n   zip -r vms.zip \\\n     vm.sh \\\n     bin/ \\\n     lib/ \\\n     README.md \\\n     -x \"*.swp\" \"*~\" \".DS_Store\" \".git/*\" \"__pycache__/*\"\n   \n   echo \"✓ Created vms.zip\"\n   echo \"Users can extract with: unzip vms.zip -d ~/vms\"\n   ```\n\n4. **Version Tracking** (optional)\n   - Include VERSION file in package\n   - Show version in vm.sh --version\n\n5. **Validation**\n   - Check all required files exist before packaging\n   - Verify vm.sh is executable\n   - Test that zip can be extracted cleanly\n\n**User Workflow After This Issue:**\n```bash\n# Developer creates package\ncd firecracker-sandbox\n./package.sh\n\n# User installs\nunzip vms.zip -d ~/\ncd ~/vms\nsudo bin/setup.sh\n```\n\n**Acceptance Criteria:**\n- package.sh creates valid vms.zip\n- zip contains all necessary files\n- zip excludes development/runtime files\n- Extracted structure works correctly\n- README.md includes installation instructions\n- Script has proper error handling","status":"closed","priority":2,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T18:56:46.950311385+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:08:58.671434624+05:30","closed_at":"2026-02-05T19:08:58.671437834+05:30","dependencies":[{"issue_id":"dev-aq9.12","depends_on_id":"dev-aq9","type":"parent-child","created_at":"2026-02-05T18:56:46.952656804+05:30","created_by":"Anand Chitipothu"}]}
{"id":"dev-aq9.2","title":"VM CLI Dispatcher (vm.sh skeleton)","description":"Create the main vm.sh dispatcher that routes commands to specialized scripts.\n\n**Scope:**\n\n1. **vm.sh** - Main entry point script\n   - Command parsing and argument handling\n   - Route commands to bin/vm-\u003ccommand\u003e.sh scripts\n   - Pass VM name and additional arguments to sub-scripts\n   - Error handling for unknown commands\n   - Help/usage message\n\n**Command Routing:**\n```\n~/vms/vm.sh create \u003cname\u003e [args]  → bin/vm-create.sh \u003cname\u003e [args]\n~/vms/vm.sh up \u003cname\u003e              → bin/vm-up.sh \u003cname\u003e\n~/vms/vm.sh down \u003cname\u003e            → bin/vm-down.sh \u003cname\u003e\n~/vms/vm.sh ssh \u003cname\u003e [args]      → bin/vm-ssh.sh \u003cname\u003e [args]\n~/vms/vm.sh status \u003cname\u003e          → bin/vm-status.sh \u003cname\u003e\n~/vms/vm.sh list                   → bin/vm-list.sh\n~/vms/vm.sh destroy \u003cname\u003e         → bin/vm-destroy.sh \u003cname\u003e\n```\n\n**Implementation:**\n- Use case statement for command dispatching\n- Use exec to replace current process with sub-script (clean process tree)\n- Preserve exit codes from sub-scripts\n- Source bin/config.sh for global configuration access\n\n**Validation:**\n- Check command is recognized\n- For commands requiring \u003cname\u003e, validate name is provided\n- Show helpful error messages with usage examples\n\n**Acceptance Criteria:**\n- vm.sh routes all commands correctly\n- Unknown commands show clear error and usage\n- Missing arguments show helpful error messages\n- Exit codes from sub-scripts are preserved\n- Help message lists all available commands","status":"closed","priority":1,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T18:05:54.894135287+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:08:50.192591365+05:30","closed_at":"2026-02-05T19:08:50.192594272+05:30","dependencies":[{"issue_id":"dev-aq9.2","depends_on_id":"dev-aq9","type":"parent-child","created_at":"2026-02-05T18:05:54.896300298+05:30","created_by":"Anand Chitipothu"}]}
{"id":"dev-aq9.3","title":"VM Build Command (vm-build.sh)","description":"Implement VM build command that reads config.sh and builds a minimal base VM instance.\n\n**Command:** `sudo ~/vms/vm.sh build \u003cname\u003e`\n\n**Prerequisites:**\n- VM must be initialized (vm init \u003cname\u003e already run)\n- config.sh exists and has been edited by user\n\n**Scope:**\n\n1. **Validation**\n   - Check VM exists (~/vms/vms/\u003cname\u003e/ directory exists)\n   - Check config.sh exists and is readable\n   - Check not already built (no rootfs.ext4)\n   - Check bridge is set up\n   - Requires sudo\n\n2. **Load Configuration**\n   - Source ~/vms/vms/\u003cname\u003e/config.sh\n   - Read: USERNAME, SSH_KEY_PATH, UBUNTU_VERSION, CPUS, MEMORY, ROOTFS_SIZE, HOME_SIZE\n   - Read IP from ~/vms/vms/\u003cname\u003e/state/ip.txt\n   - Validate all required settings present\n\n3. **Download Kernel** (shared, cached)\n   - Download vmlinux if not already at ~/vms/kernels/vmlinux-6.1.58\n   - Source: GitHub releases or specific URL (from bin/config.sh)\n   - Reused across all VMs\n\n4. **Build Base Rootfs with debootstrap**\n   - Use debootstrap to create minimal Ubuntu filesystem (version from config)\n   - Install ONLY base packages: systemd, openssh-server, linux-image-virtual\n   - Configure systemd-networkd with static IP for eth0 (from state/ip.txt)\n   - Set hostname to \u003cname\u003e (directory name)\n   - Create user account with USERNAME from config\n   - Enable SSH service\n   - Create ext4 filesystem image (ROOTFS_SIZE from config)\n   - Save as ~/vms/vms/\u003cname\u003e/rootfs.ext4\n   - Set ownership to $SUDO_USER\n\n5. **SSH Key Setup**\n   - Read SSH key from SSH_KEY_PATH (from config)\n   - Cache in ~/vms/vms/\u003cname\u003e/ssh_key.pub\n   - Mount rootfs and inject key into user's authorized_keys\n   - Also add to root's authorized_keys\n   - Unmount\n\n6. **Create Home Volume**\n   - Create empty ext4 image for /home\n   - Size from HOME_SIZE in config\n   - Save as ~/vms/vms/\u003cname\u003e/home.ext4\n   - Set ownership to $SUDO_USER\n\n7. **Create TAP Device** (requires sudo)\n   - Create dedicated TAP: tap-\u003cname\u003e\n   - Set ownership to $SUDO_USER: `ip tuntap add tap-\u003cname\u003e mode tap user \"$SUDO_USER\"`\n   - Attach to br-firecracker\n   - Bring up\n   - Save TAP name to state/tap_name.txt\n\n8. **Mark as Built**\n   - Create state/built marker file with timestamp\n   - Set all ownership to $SUDO_USER\n\n**Directory Structure After Build:**\n```\n~/vms/vms/\u003cname\u003e/\n├── state/\n│   ├── ip.txt           # Created during init\n│   ├── tap_name.txt     # Created during build\n│   └── built            # Marker that build completed\n├── config.sh            # Created during init, edited by user\n├── apt-packages.txt     # Created during init, read during first boot\n├── packages.nix         # Created during init, read during first boot\n├── ssh_key.pub          # Cached SSH key\n├── rootfs.ext4          # Minimal base image (fast to build)\n└── home.ext4            # Empty home volume\n```\n\n**Notes:**\n- Build creates MINIMAL base image only (no apt packages, no Nix)\n- Package installation happens during first boot (separate feature)\n- Build is fast and repeatable\n- Requires sudo for TAP device creation and debootstrap\n- All created files owned by $SUDO_USER for sudo-less daily operations\n\n**Acceptance Criteria:**\n- Creates minimal working Ubuntu VM with SSH access\n- User account created with USERNAME from config\n- SSH key injected correctly from SSH_KEY_PATH\n- systemd-networkd configured with correct IP\n- TAP device owned by calling user\n- VM status changes from \"pending\" to \"stopped\" after build\n- Build completes quickly (no package installation)\n- Clear error messages for missing config or invalid settings","notes":"\n**First-Boot Integration:**\n- Copy ~/vms/bin/first-boot.sh to rootfs at /first-boot.sh (world-readable, executable)\n- Copy apt-packages.txt and packages.nix to /home/\u003cusername\u003e/ in rootfs\n- vm up will execute /first-boot.sh if present, then delete it\n- For this issue: create a dummy/stub first-boot.sh that just exits 0\n- Actual first-boot.sh implementation is separate issue (dev-aq9.7)\n\n**First-Boot Integration:**\n- Copy ~/vms/bin/first-boot.sh to rootfs at /first-boot.sh (world-readable, executable)\n- Copy apt-packages.txt and packages.nix to /home/\u003cusername\u003e/ in rootfs\n- vm up will execute /first-boot.sh if present, then delete it\n- For this issue: create a dummy/stub first-boot.sh that just exits 0\n- Actual first-boot.sh implementation is separate issue (dev-aq9.7)","status":"closed","priority":1,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T18:13:40.061834221+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:08:50.943186804+05:30","closed_at":"2026-02-05T19:08:50.94319091+05:30","dependencies":[{"issue_id":"dev-aq9.3","depends_on_id":"dev-aq9","type":"parent-child","created_at":"2026-02-05T18:13:40.063572551+05:30","created_by":"Anand Chitipothu"},{"issue_id":"dev-aq9.3","depends_on_id":"dev-aq9.6","type":"blocks","created_at":"2026-02-05T18:48:40.399346183+05:30","created_by":"Anand Chitipothu"},{"issue_id":"dev-aq9.3","depends_on_id":"dev-aq9.1","type":"blocks","created_at":"2026-02-05T18:48:40.456492842+05:30","created_by":"Anand Chitipothu"}]}
{"id":"dev-aq9.4","title":"VM List Command (vm-list.sh)","description":"Implement VM list command to show all VMs and their status.\n\n**Command:** `~/vms/vm.sh list`\n\n**Scope:**\n\n1. **Scan VM Directories**\n   - Iterate through ~/vms/vms/*/ directories\n   - VM name = directory basename\n   - Skip if not a directory or no state/ subdirectory\n\n2. **Gather VM Information**\n   - Read IP from vms/\u003cname\u003e/state/ip.txt\n   - Determine status:\n     * **pending**: has config.sh but no rootfs.ext4\n     * **running**: has rootfs.ext4 and state/vm.pid with alive process\n     * **stopped**: has rootfs.ext4 but no vm.pid or dead process\n     * **crashed**: has vm.pid but process is dead (stale pid)\n   - Calculate uptime if running (process start time)\n   - Handle missing state gracefully\n\n3. **Display Table**\n   - Format: NAME, IP, STATUS, UPTIME\n   - Example output:\n     ```\n     NAME        IP              STATUS      UPTIME\n     dev         172.16.0.2      pending     -\n     claude      172.16.0.3      running     2h 34m\n     postgres    172.16.0.4      stopped     -\n     test        172.16.0.5      crashed     -\n     ```\n   - Sort by name alphabetically\n   - Show message if no VMs exist\n\n4. **Status Detection Logic**\n   - pending: config.sh exists, rootfs.ext4 doesn't exist\n   - running: rootfs.ext4 exists, vm.pid exists, process alive\n   - stopped: rootfs.ext4 exists, no vm.pid or clean shutdown\n   - crashed: rootfs.ext4 exists, vm.pid exists, process dead\n\n**Requirements:**\n- No sudo required\n- Works even if some VMs have incomplete state\n- Clean error handling for corrupted state\n\n**Acceptance Criteria:**\n- Lists all VMs with correct status including pending\n- Uptime calculated accurately for running VMs\n- Handles edge cases (missing files, stale pids)\n- Clean tabular output\n- Shows pending VMs (initialized but not built)","status":"closed","priority":1,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T18:16:46.455579474+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:08:51.35171976+05:30","closed_at":"2026-02-05T19:08:51.351723388+05:30","dependencies":[{"issue_id":"dev-aq9.4","depends_on_id":"dev-aq9","type":"parent-child","created_at":"2026-02-05T18:16:46.457600057+05:30","created_by":"Anand Chitipothu"}]}
{"id":"dev-aq9.5","title":"VM Destroy Command (vm-destroy.sh)","description":"Implement VM destroy command to completely remove a VM instance.\n\n**Command:** `sudo ~/vms/vm.sh destroy \u003cname\u003e`\n\n**Scope:**\n\n1. **Root Check**\n   - Check if running as root (EUID = 0)\n   - Exit with error if not: \"Error: vm destroy requires sudo\"\n   - Must be first check before any operations\n\n2. **Validation**\n   - Check VM exists (~/vms/vms/\u003cname\u003e/ directory exists)\n   - Load VM state from vms/\u003cname\u003e/state/\n\n3. **Confirmation** (Optional but recommended)\n   - Warn about data loss (home.ext4 will be deleted)\n   - Ask for confirmation: \"Destroy VM '\u003cname\u003e'? This will delete all data. [y/N]\"\n   - Support --force flag to skip confirmation\n\n4. **Stop VM if Running**\n   - Check if VM is running (state/vm.pid)\n   - If running, stop gracefully first\n   - Wait for shutdown (timeout 30s)\n   - Kill forcefully if doesn't stop\n\n5. **Remove TAP Device** (requires sudo)\n   - Read TAP name from state/tap_name.txt or derive as tap-\u003cname\u003e\n   - Delete TAP: `ip link delete tap-\u003cname\u003e`\n   - Handle error if TAP doesn't exist (non-fatal)\n\n6. **Delete VM Files**\n   - Remove entire ~/vms/vms/\u003cname\u003e/ directory:\n     * rootfs.ext4\n     * home.ext4 (data loss!)\n     * config.sh\n     * state/ directory and all contents\n   - Use rm -rf (careful!)\n\n7. **Cleanup Ownership**\n   - All operations as root, but ensure clean removal\n\n**Requirements:**\n- MUST run as root (sudo)\n- Confirmation before destructive operations\n- Graceful VM shutdown before removal\n- Clear error messages\n\n**Acceptance Criteria:**\n- Errors immediately if not run as root\n- Successfully removes all VM files and TAP device\n- Stops running VM before removal\n- Confirmation prompt works (skippable with --force)\n- Handles edge cases (already stopped, TAP missing, etc.)\n- No traces of VM left after destroy","status":"closed","priority":1,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T18:17:00.38159893+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:08:51.917199054+05:30","closed_at":"2026-02-05T19:08:51.917202446+05:30","dependencies":[{"issue_id":"dev-aq9.5","depends_on_id":"dev-aq9","type":"parent-child","created_at":"2026-02-05T18:17:00.383905133+05:30","created_by":"Anand Chitipothu"},{"issue_id":"dev-aq9.5","depends_on_id":"dev-aq9.3","type":"blocks","created_at":"2026-02-05T18:48:40.81311381+05:30","created_by":"Anand Chitipothu"},{"issue_id":"dev-aq9.5","depends_on_id":"dev-aq9.9","type":"blocks","created_at":"2026-02-05T18:48:40.87192314+05:30","created_by":"Anand Chitipothu"}]}
{"id":"dev-aq9.6","title":"VM Init Command (vm-init.sh)","description":"Implement VM initialization command to create configuration without building.\n\n**Command:** `~/vms/vm.sh init \u003cname\u003e`\n\n**Scope:**\n\n1. **Validation**\n   - Check VM name is valid (alphanumeric, hyphens, underscores)\n   - Check VM doesn't already exist (~/vms/vms/\u003cname\u003e/ not present)\n   - Check bridge is set up (state/bridge symlink exists)\n   - No sudo required\n\n2. **Create VM Directory Structure**\n   - mkdir -p ~/vms/vms/\u003cname\u003e/state/\n   - VM name = directory basename = hostname\n\n3. **Auto-assign IP**\n   - Scan existing VMs state/ip.txt files\n   - Assign next available IP (.2, .3, .4, etc.)\n   - Save to ~/vms/vms/\u003cname\u003e/state/ip.txt\n   - Validate IP not in use\n\n4. **Detect SSH Key**\n   - Search for SSH public keys in ~/.ssh/\n   - Look for: id_ed25519.pub, id_rsa.pub, id_ecdsa.pub (in that order)\n   - Use first found key\n   - If no key found, leave SSH_KEY_PATH commented with helpful message\n\n5. **Detect Username**\n   - Set to current user ($USER)\n\n6. **Generate config.sh Template**\n   - Create ~/vms/vms/\u003cname\u003e/config.sh:\n     ```bash\n     # VM Configuration for \u003cname\u003e\n     # Edit this file, then run: sudo ~/vms/vm.sh build \u003cname\u003e\n     \n     # Resources\n     CPUS=4\n     MEMORY=8192\n     ROOTFS_SIZE=\"8G\"\n     HOME_SIZE=\"20G\"\n     \n     # User setup\n     USERNAME=\"\u003cdetected-user\u003e\"\n     SSH_KEY_PATH=\"\u003cdetected-key-path\u003e\"\n     \n     # Ubuntu version\n     UBUNTU_VERSION=\"24.04\"  # noble\n     ```\n\n7. **Generate Package Files**\n   - Create ~/vms/vms/\u003cname\u003e/apt-packages.txt:\n     ```\n     # APT packages to install (one per line)\n     # Lines starting with # are comments\n     \n     podman\n     postgresql\n     tmux\n     vim\n     git\n     curl\n     ```\n   - Create ~/vms/vms/\u003cname\u003e/packages.nix:\n     ```\n     # Nix packages to install (space-separated)\n     go_1_24 nodejs\n     ```\n\n8. **Print Success Message**\n   - Show config file location\n   - Show package files location\n   - Show next steps: edit files, then run build\n   - Example: \n     ```\n     ✓ Initialized VM 'claude' with IP 172.16.0.2\n       Config: ~/vms/vms/claude/config.sh\n       Packages: ~/vms/vms/claude/apt-packages.txt\n       Nix: ~/vms/vms/claude/packages.nix\n       Next: sudo ~/vms/vm.sh build claude\n     ```\n\n**Status in vm list:**\n- After init, VM appears as \"pending\" status\n- pending = has config.sh but no rootfs.ext4\n\n**Acceptance Criteria:**\n- Creates directory structure without sudo\n- Auto-assigns unique IP\n- Detects and sets SSH_KEY_PATH automatically\n- Sets USERNAME to current user\n- Generated config.sh is valid and editable\n- Generated apt-packages.txt and packages.nix with sensible defaults\n- VM appears as \"pending\" in vm list\n- Clear next steps shown to user","status":"closed","priority":1,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T18:31:41.38496251+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:08:52.458229719+05:30","closed_at":"2026-02-05T19:08:52.458233273+05:30","dependencies":[{"issue_id":"dev-aq9.6","depends_on_id":"dev-aq9","type":"parent-child","created_at":"2026-02-05T18:31:41.386990188+05:30","created_by":"Anand Chitipothu"},{"issue_id":"dev-aq9.6","depends_on_id":"dev-aq9.1","type":"blocks","created_at":"2026-02-05T18:48:40.344132451+05:30","created_by":"Anand Chitipothu"}]}
{"id":"dev-aq9.7","title":"First-Boot Automation \u0026 Package Installation","description":"Implement bin/first-boot.sh script that installs packages on first VM boot.\n\n**Location:** ~/vms/bin/first-boot.sh (copied to /first-boot.sh in VM during build)\n\n**Execution:** Runs inside the VM on first boot (triggered by vm up)\n\n**Scope:**\n\n1. **Script Location \u0026 Integration**\n   - Lives at ~/vms/bin/first-boot.sh on host\n   - Build copies it to /first-boot.sh in rootfs\n   - vm up executes it via SSH if present, then deletes it\n   - Runs as root inside the VM\n\n2. **Read Package Files**\n   - apt-packages.txt and packages.nix are in /home/\u003cusername\u003e/ (copied during build)\n   - Read and parse both files\n   - Skip comments (#) and empty lines in apt-packages.txt\n   - Parse space-separated package names in packages.nix\n\n3. **Install APT Packages**\n   - Run: apt-get update\n   - Install packages from apt-packages.txt one by one\n   - Continue on errors (log failed packages)\n   - Example: apt-get install -y podman postgresql tmux\n\n4. **Install Nix Package Manager**\n   - Download and run Nix installer as the user:\n     ```bash\n     su - \u003cusername\u003e -c 'curl -L https://nixos.org/nix/install | sh -s -- --daemon'\n     ```\n   - Verify Nix installation\n   - Source Nix profile\n\n5. **Install Nix Packages**\n   - Install packages from packages.nix as the user\n   - Run: su - \u003cusername\u003e -c 'nix-env -iA nixpkgs.\u003cpackage\u003e'\n   - Continue on errors (log failed packages)\n\n6. **Logging**\n   - Log all output to /var/log/first-boot.log\n   - Include timestamps\n   - Log both stdout and stderr\n   - Exit code 0 on success (even with some package failures)\n\n7. **Progress Indicators**\n   - Echo progress messages (vm up will show them via SSH)\n   - Example output:\n     ```\n     Installing APT packages...\n     - podman: OK\n     - postgresql: OK\n     Installing Nix...\n     - Nix installed successfully\n     Installing Nix packages...\n     - go_1_24: OK\n     - nodejs: OK\n     First-boot setup complete\n     ```\n\n**Error Handling:**\n- Continue on individual package failures\n- Log errors but don't fail entire script\n- Exit 0 unless critical failure (apt-get update fails, Nix install fails)\n\n**Self-Deletion:**\n- vm up deletes /first-boot.sh after execution\n- Script doesn't need to delete itself\n\n**Testing:**\n- Can be tested independently in a VM\n- Should work with empty package files\n- Should handle missing package files gracefully\n\n**Acceptance Criteria:**\n- Installs all APT packages successfully\n- Installs Nix successfully\n- Installs all Nix packages successfully\n- Logs to /var/log/first-boot.log\n- Clear progress output\n- Handles errors gracefully (continues on package failures)\n- Works when package files are empty or missing","status":"closed","priority":1,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T18:40:00.199751665+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:08:56.014130255+05:30","closed_at":"2026-02-05T19:08:56.014133808+05:30","dependencies":[{"issue_id":"dev-aq9.7","depends_on_id":"dev-aq9","type":"parent-child","created_at":"2026-02-05T18:40:00.201448162+05:30","created_by":"Anand Chitipothu"}]}
{"id":"dev-aq9.8","title":"VM Up Command (vm-up.sh)","description":"Implement VM up command to start a VM and make it ready for use.\n\n**Command:** `~/vms/vm.sh up \u003cname\u003e` (no sudo required)\n\n**Prerequisites:**\n- VM must be built (rootfs.ext4 exists)\n- Bridge and TAP device already set up\n\n**Scope:**\n\n1. **Validation**\n   - Check VM exists and is built (rootfs.ext4 present)\n   - Check not already running (no valid vm.pid)\n   - Load config.sh and state files (ip.txt, tap_name.txt)\n   - Check TAP device exists and is owned by current user\n\n2. **Check IP Conflict**\n   - Scan other VMs to ensure GUEST_IP not in use by running VM\n   - Error if conflict detected\n\n3. **Start Firecracker VM**\n   - Build firecracker config JSON with:\n     * Kernel path (from ~/vms/kernels/)\n     * Rootfs path (~/vms/vms/\u003cname\u003e/rootfs.ext4)\n     * Home drive path (~/vms/vms/\u003cname\u003e/home.ext4) mounted as /home\n     * Network: TAP device (tap-\u003cname\u003e), guest IP from state/ip.txt\n     * CPU and memory from config.sh\n   - Start firecracker in background\n   - Save PID to state/vm.pid\n   - Save socket path to state/vm.sock\n\n4. **Wait for SSH Ready**\n   - Poll SSH connection: ssh -o ConnectTimeout=2 \u003cuser\u003e@\u003cip\u003e exit\n   - Retry with exponential backoff (1s, 2s, 4s...)\n   - Timeout after 2 minutes\n   - Show progress: \"Waiting for VM to boot...\"\n\n5. **Execute First-Boot Script** (if present)\n   - Check if /first-boot.sh exists in VM: ssh \u003cvm\u003e test -f /first-boot.sh\n   - If exists:\n     * Execute via SSH: ssh \u003cvm\u003e /first-boot.sh\n     * Stream output to terminal (show progress)\n     * Wait for completion\n     * Delete script: ssh \u003cvm\u003e rm /first-boot.sh\n     * Show: \"✓ First-boot setup complete\"\n   - If doesn't exist or already run: skip (fast boot)\n\n6. **Print Ready Message**\n   - Show VM details:\n     ```\n     ✓ VM 'claude' is ready\n       IP: 172.16.0.2\n       SSH: ssh \u003cuser\u003e@172.16.0.2\n       Or: ~/vms/vm.sh ssh claude\n     ```\n\n**State After Up:**\n- state/vm.pid contains running process ID\n- state/vm.sock contains firecracker socket path\n- /first-boot.sh deleted from VM (if it was present)\n- vm list shows VM as \"running\"\n\n**Error Handling:**\n- If VM fails to start, clean up state (remove vm.pid)\n- If SSH timeout, kill VM and error\n- If first-boot.sh fails, leave VM running but show error\n- Clear error messages for all failure cases\n\n**No Sudo Required:**\n- TAP device already owned by user (created during build)\n- Firecracker runs as current user\n- All state files owned by user\n\n**Acceptance Criteria:**\n- Starts VM successfully without sudo\n- Waits for SSH before declaring ready\n- Executes first-boot.sh if present\n- Fast boot on subsequent starts (no first-boot)\n- Shows clear progress and ready message\n- Handles errors gracefully with cleanup\n- VM accessible via SSH after up completes","status":"closed","priority":1,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T18:46:36.585629566+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:08:56.46643194+05:30","closed_at":"2026-02-05T19:08:56.466435586+05:30","dependencies":[{"issue_id":"dev-aq9.8","depends_on_id":"dev-aq9","type":"parent-child","created_at":"2026-02-05T18:46:36.587407245+05:30","created_by":"Anand Chitipothu"},{"issue_id":"dev-aq9.8","depends_on_id":"dev-aq9.3","type":"blocks","created_at":"2026-02-05T18:48:40.574928135+05:30","created_by":"Anand Chitipothu"}]}
{"id":"dev-aq9.9","title":"VM Down Command (vm-down.sh)","description":"Implement VM down command to gracefully stop a running VM.\n\n**Command:** `~/vms/vm.sh down \u003cname\u003e` (no sudo required)\n\n**Scope:**\n\n1. **Validation**\n   - Check VM exists\n   - Check if running (validate state/vm.pid and process is alive)\n   - If not running, show message and exit successfully\n   - Load state files\n\n2. **Graceful Shutdown**\n   - SSH into VM: ssh \u003cuser\u003e@\u003cip\u003e \"sudo poweroff\"\n   - This triggers clean systemd shutdown inside VM\n   - Wait for process to exit (poll vm.pid)\n   - Timeout after 30 seconds\n\n3. **Forceful Shutdown** (if graceful fails)\n   - If VM doesn't stop after 30s, kill firecracker process\n   - Send SIGTERM first, wait 5s\n   - Send SIGKILL if still alive\n   - Show warning: \"VM did not stop gracefully, killed forcefully\"\n\n4. **Cleanup State**\n   - Remove state/vm.pid\n   - Remove state/vm.sock\n   - Leave TAP device active (persistent until destroy)\n   - Leave rootfs, home, and other files intact\n\n5. **Print Success Message**\n   - Show: \"✓ VM 'claude' stopped\"\n   - vm list should now show VM as \"stopped\"\n\n**No Sudo Required:**\n- All operations run as current user\n- SSH uses user credentials\n- Process kill uses user's own process\n\n**Error Handling:**\n- If VM already stopped, exit successfully with message\n- If SSH fails, fall back to forceful kill\n- If PID file stale (process doesn't exist), clean up gracefully\n- Clear error messages\n\n**Acceptance Criteria:**\n- Stops running VM gracefully without sudo\n- Falls back to forceful kill if needed\n- Cleans up state files correctly\n- Leaves VM in clean stopped state\n- vm list shows \"stopped\" after down\n- Can run vm up again after down","status":"closed","priority":1,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T18:47:39.800231293+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T19:08:57.00028764+05:30","closed_at":"2026-02-05T19:08:57.000291981+05:30","dependencies":[{"issue_id":"dev-aq9.9","depends_on_id":"dev-aq9","type":"parent-child","created_at":"2026-02-05T18:47:39.802437963+05:30","created_by":"Anand Chitipothu"},{"issue_id":"dev-aq9.9","depends_on_id":"dev-aq9.8","type":"blocks","created_at":"2026-02-05T18:48:40.690441277+05:30","created_by":"Anand Chitipothu"}]}
{"id":"dev-bk6","title":"Package script should create proper vms/ directory structure and use dist/","description":"The package.sh script has several issues:\n\n1. The zip file should contain a vms/ directory so that when extracted, it creates a proper vms/ subdirectory\n2. Currently unzipping directly in home directory would scatter files, not create vms/ folder\n3. The package (vms.zip) should be output to dist/ directory instead of current directory\n4. dist/ directory needs to be added to .gitignore\n\nExpected behavior:\n- User can run: unzip vms.zip in their home directory\n- This creates ~/vms/ with all contents inside it\n- Package script outputs to dist/vms.zip\n- dist/ is gitignored","status":"closed","priority":2,"issue_type":"bug","owner":"anandology@gmail.com","created_at":"2026-02-05T20:44:39.231030906+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T21:03:34.192884196+05:30","closed_at":"2026-02-05T21:03:34.192884196+05:30","close_reason":"Closed","comments":[{"id":1,"issue_id":"dev-bk6","author":"Anand Chitipothu","text":"Additional issue found: The package.sh script currently creates dist/ in the parent directory (../dist/) but it should create it in firecracker-sandbox/ directory itself.\n\nCurrent: SCRIPT_DIR/../dist/vms.zip\nExpected: SCRIPT_DIR/dist/vms.zip (i.e., firecracker-sandbox/dist/vms.zip)\n\nAlso, note that $(cd \"$(dirname \"$0\")\" \u0026\u0026 pwd) can be replaced with the simpler realpath command which is available as a standard command:\n- Old: SCRIPT_DIR=\"$(cd \"$(dirname \"$0\")\" \u0026\u0026 pwd)\"\n- New: SCRIPT_DIR=\"$(dirname \"$(realpath \"$0\")\")\"\n\nThis makes the code cleaner and more readable.","created_at":"2026-02-05T15:31:56Z"}]}
{"id":"dev-df1","title":"Configure guest VM timezone to match host by default","description":"The guest VM should have the same timezone as the host system for consistency.\n\n**Requirements:**\n- Add `TIMEZONE` configuration option in VM config.sh\n- If `TIMEZONE` is not set, auto-detect and use the host's timezone\n- Configure timezone during VM build process (before first boot)\n- Host timezone can be detected using: `timedatectl show -p Timezone --value` or `cat /etc/timezone`\n\n**Acceptance Criteria:**\n- New VMs default to host timezone when `TIMEZONE` is unset in config.sh\n- Users can override timezone by setting `TIMEZONE` in config.sh (e.g., `TIMEZONE=\"America/New_York\"`)\n- Timezone is properly configured in the guest VM during build\n- Documentation updated to explain the timezone configuration option","status":"open","priority":2,"issue_type":"feature","owner":"anandology@gmail.com","created_at":"2026-02-05T22:14:21.09340346+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T22:14:21.09340346+05:30","labels":["enhancement","firecracker-sandbox"]}
{"id":"dev-oi2","title":"Scripts fail when run with sudo: $HOME becomes /root instead of user home","description":"setup.sh and other scripts that run with sudo have a critical issue: $HOME becomes /root instead of the actual user's home directory.\n\nRoot cause:\n- config.sh line 24 uses: VMS_ROOT=\"${VMS_ROOT:-$HOME/vms}\"\n- When run with sudo, $HOME is /root, not the user's home\n- This causes all paths to be resolved incorrectly\n\nSolution:\nAll scripts should determine the ROOT_DIRECTORY based on $0 (the script's location) instead of relying on $HOME or environment variables:\n\n- Scripts are located in $ROOT/bin/ \n- Therefore: ROOT=$(cd \"$(dirname \"$0\")/..\" \u0026\u0026 pwd)\n- From there: VMS_ROOT=$ROOT, BIN_DIR=$ROOT/bin, etc.\n\nThis makes the framework self-contained and location-independent.\n\nFiles affected:\n- config.sh (line 24)\n- vm-init.sh (line 93 - SSH key paths)\n- Any other scripts using $HOME","status":"closed","priority":1,"issue_type":"bug","owner":"anandology@gmail.com","created_at":"2026-02-05T20:47:51.706547289+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T20:49:42.195885063+05:30","closed_at":"2026-02-05T20:49:42.195885063+05:30","close_reason":"Closed"}
{"id":"dev-ue4","title":"Kernel download fails - invalid S3 URL for vmlinux-6.1.102","description":"When building a VM, the kernel download fails because the S3 URL returns NoSuchKey error.\n\n**Current Configuration:**\n- Firecracker version: v1.7.0\n- Kernel version: 6.1.102\n- URL: https://s3.amazonaws.com/spec.ccfc.min/firecracker-ci/v1.7/6.1.102/x86_64/vmlinux-6.1.102\n\n**Error:**\n```xml\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eNoSuchKey\u003c/Code\u003e\u003cMessage\u003eThe specified key does not exist.\u003c/Message\u003e\u003c/Error\u003e\n```\n\n**Root Cause:**\nThe kernel version 6.1.102 doesn't exist at the specified S3 path for Firecracker v1.7.\n\n**Solution:**\nNeed to find and use a valid kernel version available for Firecracker v1.7.0.\n\n**Files to update:**\n- `firecracker-sandbox/bin/config.sh` - Update KERNEL_VERSION and KERNEL_URL","notes":"## Solution Found\n\nThe kernel should use the Firecracker quickstart guide kernel which is maintained and available:\n\n**Working Kernel:**\n- URL: https://s3.amazonaws.com/spec.ccfc.min/img/quickstart_guide/x86_64/kernels/vmlinux.bin\n- This is the official kernel referenced in Firecracker documentation\n- Size: ~21MB\n\n**Change:**\nUpdate `firecracker-sandbox/bin/config.sh`:\n```bash\nKERNEL_VERSION=\"vmlinux.bin\"\nKERNEL_URL=\"https://s3.amazonaws.com/spec.ccfc.min/img/quickstart_guide/x86_64/kernels/vmlinux.bin\"\n```\n\n**Note:** Users with the broken kernel file will need to delete it and let the build script re-download:\n```bash\nrm ~/vms/kernels/vmlinux-6.1.102\n```","status":"open","priority":1,"issue_type":"bug","owner":"anandology@gmail.com","created_at":"2026-02-05T22:27:12.998439722+05:30","created_by":"Anand Chitipothu","updated_at":"2026-02-05T22:27:51.978133342+05:30","labels":["bug","firecracker-sandbox"]}
